stages:
  - test

# Version SIMPLE qui fonctionne avec les runners partagÃ©s standards
test-php-simple:
  stage: test
  image: php:8.1-apache
  script:
    - echo "ğŸš€ DÃ©marrage des tests PHP..."
    
    # Mise Ã  jour et installation basique
    - apt-get update && apt-get install -y curl git
    
    # VÃ©rifications
    - echo "=== VÃ‰RIFICATIONS ==="
    - php --version
    - php -m | grep -i mysql
    
    # Structure du projet
    - echo "=== STRUCTURE DU PROJET ==="
    - ls -la
    
    - echo "=== DOSSIER CONTROLEUR ==="
    - ls -la Controleur/ 2>/dev/null || echo "âš ï¸ Dossier Controleur non trouvÃ©"
    
    - echo "=== DOSSIER TESTS ==="
    - ls -la tests/ 2>/dev/null || echo "âš ï¸ Dossier tests non trouvÃ©"
    
    # ExÃ©cution des tests
    - echo "=== EXÃ‰CUTION DES TESTS ==="
    - if [ -f "tests/test_basic.php" ]; then
        php tests/test_basic.php
        echo "âœ… Test PHP exÃ©cutÃ© avec succÃ¨s"
      else
        echo "ğŸ“ CrÃ©ation d'un test basique..."
        echo '<?php 
          echo "ğŸ‰ Test GitLab CI/CD rÃ©ussi!\n";
          echo "PHP Version: " . phpversion() . "\n";
          echo "Extensions chargÃ©es:\n";
          foreach(get_loaded_extensions() as $ext) {
            echo "  - $ext\n";
          }
        ?>' > test_ci.php
        php test_ci.php
        rm test_ci.php
      fi
    
    - echo "ğŸ‰ PIPELINE TERMINÃ‰ AVEC SUCCÃˆS !"
  only:
    - main
    - merge_requests