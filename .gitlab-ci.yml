stages:
  - test

test-all:
  stage: test
  image: php:8.1-apache
  script:
    - echo "ğŸš€ Pipeline CI/CD GitLab"
    - echo "ğŸ“… $(date)"
    
    # Test PHP
    - php --version
    
    # Test MySQL extensions
    - php -r "echo extension_loaded('mysqli') ? 'âœ… MySQLi OK\n' : 'âŒ MySQLi KO\n';"
    - php -r "echo extension_loaded('pdo_mysql') ? 'âœ… PDO MySQL OK\n' : 'âŒ PDO MySQL KO\n';"
    
    # Test fichiers
    - ls -la
    
    # Test personnalisÃ©
    - |
      if [ -f "tests/test_basic.php" ]; then
        php tests/test_basic.php
      else
        echo '<?php echo "âœ… Application fonctionne"; ?>' | php
      fi
    
    - echo "ğŸ‰ Pipeline terminÃ© avec succÃ¨s!"
    - echo ""
    - echo "ğŸ“¦ Pour Docker Hub (manuel) :"
    - echo "   docker build -t $DOCKERHUB_IMAGE:$CI_COMMIT_SHORT_SHA ."
    - echo "   docker push $DOCKERHUB_IMAGE:$CI_COMMIT_SHORT_SHA"
  only:
    - main