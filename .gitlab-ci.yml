image: php:8.1-apache

cache:
  paths:
    - vendor/
  key: "${CI_COMMIT_REF_SLUG}"

stages:
  - install
  - test
  - deploy

install-dependencies:
  stage: install
  script:
    - echo "ğŸ“¦ Installation dÃ©pendances..."
    - apt-get update && apt-get install -y curl git unzip
    # Si vous utilisez Composer:
    # - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    # - composer install --no-progress --no-interaction
    - echo "âœ… DÃ©pendances installÃ©es"
  artifacts:
    paths:
      - vendor/
    expire_in: 1 hour

test:
  stage: test
  script:
    - echo "ğŸ§ª ExÃ©cution des tests..."
    - php --version
    
    # ExÃ©cuter vos tests existants
    - |
      if [ -f "tests/test_basic.php" ]; then
        echo "ğŸ” ExÃ©cution des tests..."
        php tests/test_basic.php
      else
        echo "ğŸ“ CrÃ©ation test basique..."
        echo '<?php echo "âœ… Tests GitLab CI/CD\n"; ?>' > test_ci.php
        php test_ci.php
        rm test_ci.php
      fi
    
    - echo "âœ… Tests terminÃ©s"
  dependencies:
    - install-dependencies

deploy:
  stage: deploy
  script:
    - echo "ğŸš€ DÃ©ploiement..."
    - echo "âœ… Application prÃªte"
  only:
    - main
  when: manual