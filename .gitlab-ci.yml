stages:
  - test

test-php-simple:
  stage: test
  image: php:8.1-apache
  before_script:
    - apt-get update && apt-get install -y curl git
  script:
    - echo "üöÄ D√©marrage des tests PHP..."
    - echo "=== V√âRIFICATIONS ==="
    - php --version
    - php -m
    
    - echo "=== STRUCTURE ==="
    - ls -la
    
    - echo "=== CONTROLEUR ==="
    - ls -la Controleur/ 2>/dev/null || echo "Pas de dossier Controleur"
    
    - echo "=== TESTS ==="
    - ls -la tests/ 2>/dev/null || echo "Pas de dossier tests"
    
    # Test PHP simple
    - echo "=== TEST PHP ==="
    - php -r "echo '‚úÖ PHP fonctionne correctement\n';"
    
    # V√©rifier MySQL extension
    - php -r "echo extension_loaded('mysqli') ? '‚úÖ MySQLi activ√©\n' : '‚ö†Ô∏è MySQLi non activ√©\n';"
    - php -r "echo extension_loaded('pdo_mysql') ? '‚úÖ PDO MySQL activ√©\n' : '‚ö†Ô∏è PDO MySQL non activ√©\n';"
    
    # Si fichier test existe
    - |
      if [ -f "tests/test_basic.php" ]; then
        echo "=== EX√âCUTION TEST EXISTANT ==="
        php tests/test_basic.php
      else
        echo "=== CR√âATION TEST SIMPLE ==="
        echo '<?php echo "üéâ Pipeline GitLab CI/CD r√©ussi!"; ?>' > test_gitlab.php
        php test_gitlab.php
        rm test_gitlab.php
      fi
    
    - echo "‚úÖ PIPELINE TERMIN√â AVEC SUCC√àS !"
  only:
    - main
    - merge_requests