stages:
  - test

test:
  stage: test
  image: php:8.1-apache
  services:
    - mysql:8.0
  variables:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: monblog
  before_script:
    - apt-get update && apt-get install -y default-mysql-client
  script:
    - echo "üöÄ D√©marrage des tests..."
    
    # Test 1: PHP
    - echo "‚úÖ PHP Version:"
    - php --version
    
    # Test 2: MySQL
    - echo "‚úÖ Test MySQL..."
    - mysql -h mysql -uroot -proot -e "SHOW DATABASES;"
    
    # Test 3: Cr√©ation base
    - echo "‚úÖ Cr√©ation base de donn√©es..."
    - mysql -h mysql -uroot -proot -e "CREATE DATABASE IF NOT EXISTS monblog; USE monblog; SELECT 'Base pr√™te' as status;"
    
    # Test 4: Extensions PHP (CORRIG√â)
    - echo "‚úÖ V√©rification extensions..."
    - |
      php -r '
      echo extension_loaded("mysqli") ? "‚úÖ MySQLi activ√©\n" : "‚ùå MySQLi manquant\n";
      echo extension_loaded("pdo_mysql") ? "‚úÖ PDO MySQL activ√©\n" : "‚ùå PDO MySQL manquant\n";
      '
    
    # Test 5: Fichiers projet
    - echo "‚úÖ Structure projet..."
    - ls -la
    
    - echo "üéâ Tous les tests pass√©s !"
  only:
    - main